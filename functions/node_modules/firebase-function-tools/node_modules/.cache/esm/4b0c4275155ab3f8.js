let database,admin;_155‍.x([["default",()=>_155‍.o]]);_155‍.w("firebase-functions",[["database",["database"],function(v){database=v}]]);_155‍.w("firebase-admin",[["default",["admin"],function(v){admin=v}]]);


_155‍.d(database
  .ref('/user_chat_messages/{senderUid}/{receiverUid}/{messageUid}')
  .onUpdate(async (data, context) => {
    const { authType, params, timestamp } = context
    const { senderUid, receiverUid, messageUid } = params

    if (authType === 'ADMIN') {
      return
    }

    if (data.after.child('isRead').val() === true) {
      await admin
        .database()
        .ref(`/user_chat_messages/${receiverUid}/${senderUid}/${messageUid}`)
        .update({
          isRead: timestamp,
        })

      await admin
        .database()
        .ref(`/user_chats/${senderUid}/${receiverUid}`)
        .update({ isRead: timestamp })

      await admin
        .database()
        .ref(`/user_chats/${receiverUid}/${senderUid}`)
        .update({ isRead: timestamp })
    }

    return
  }));
